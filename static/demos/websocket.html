<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
<script>
    // 設置重連時间间隔（单位：毫秒）
    const RECONNECT_INTERVAL = 1000;

    // 設置最大重連次數
    const MAX_RECONNECT_TIMES = 3;

    let reconnectTimes = 0;
    let ws;

    // 尝试連接 WebSocket
    function connect() {
        ws = new WebSocket('wss://127.0.0.1/ws_visitor?visitor_id=5|a780d122-daa3-4315-a413-f93b29b026d0&to_id=taoshihan');

        ws.onopen = function () {
            console.log('WebSocket 連接已打开');
            reconnectTimes = 0;
        };

        ws.onclose = function () {
            console.log('WebSocket 連接已關閉');
            // 尝试重連
            reconnect();
        };
        ws.onmessage = function (event) {
            console.log(`收到服務器的消息：${event.data}`);

            // // 解析消息
            // const message = JSON.parse(event.data);
            // if (message.type === 'message') {
            //     console.log(`收到消息：${message.data}`);
            // }
        };
    }

    // 尝试重連
    function reconnect() {
        if (reconnectTimes >= MAX_RECONNECT_TIMES) {
            console.log('重連失敗');
            return;
        }

        reconnectTimes++;
        console.log(`正在尝试重連（第 ${reconnectTimes} 次）`);

        setTimeout(function () {
            connect();
        }, RECONNECT_INTERVAL);
    }

    connect();
</script>
</html>